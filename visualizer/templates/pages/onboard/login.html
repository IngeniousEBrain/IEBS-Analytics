{% load static %}
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>IE-Brain Patent Pulse| Login</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- icheck bootstrap -->
    <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <style>
        body {
        font-family: 'Open Sans', sans-serif;
        background-image: linear-gradient(135deg, #6dd5ed, #2193b0);
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .login-box {
        background: #fff;
        box-shadow: 0 0 30px rgba(105, 240, 174, 0.5);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        align-items: center;
        justify-content: center;
      }

      .login-box img {
        width: 100px;
        margin-bottom: 10px;
      }

      h2 {
        color: #e66992;
        margin-bottom: 30px;
      }

      .input-group {
        position: relative;
        margin: 20px 0;
      }

      .input-group input {
        border: 1px solid #6dd5ed;
        border-radius: 5px;
        outline: none;
        padding: 10px 15px;
        width: 100%;
        color: #444;
      }

      .input-group label {
        left: 15px;
        pointer-events: none;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        transition: top 200ms, font-size 200ms;
      }

      .input-group input:focus + label {
        color: #e66992;
        font-size: 0.75em;
        top: 0;
      }

      button[type="submit"] {
        background: #2193b0;
        border: 0;
        border-radius: 5px;
        color: #fff;
        cursor: pointer;
        font-weight: 600;
        padding: 10px 20px;
        width: 100%;
      }

      button[type="submit"]:hover {
        background: #1d7d9f;
        transition: background 200ms;
      }
      a {
        color: #6dd5ed;
      }
      p {
        color: #6f90a3;
        font-size: 0.9em;
        margin-top: 10px;
      }
      .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: .875rem;
        line-height: 1.5;
        border-radius: 0.2rem;
      }
      #login-btn {
        padding: 5px 10px;
        max-width: 150px;
        white-space: normal;
        text-align: center;
      }
      .login-logo a {
        color: #2193b0;
      }
      .login-card-body {
        color: #2193b0;
      }
        #logo{
        text-align: center;
        align-item: center;
        }
    </style>
</head>
<body class="hold-transition login-page">
<div class="login-box">
    <img id="logo" src="{% static 'img/inginious_logo.png' %}">
    <div class="login-logo">
        <a href="https://www.iebrain.com/" target="_blank"><b>IE-Brain Patent Pulse</b></a>
    </div>
    <!-- /.login-logo -->
    <div class="card">
        <div class="card-body login-card-body">
            <p class="login-box-msg">Sign in to start your session</p>
            <h6 style="color: rgb(187, 33, 33); text-align: center;" id="message"></h6>
            <div class="input-group mb-3">
                <input type="text" class="form-control" id="username" placeholder="Username*" required>
                <div class="input-group-append">
                    <div class="input-group-text">
                        <span class="fas fa-envelope"></span>
                    </div>
                </div>
            </div>
            <div class="input-group mb-3">
                <input type="password" class="form-control" id="password" placeholder="Password*" required>
                <div class="input-group-append">
                    <div class="input-group-text">
                        <span class="fas fa-lock"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-8">
                </div>
                <!-- /.col -->
                <div class="col-4">
                    <button type="submit" id="login-btn" class="btn btn-primary btn-block">Sign In</button>
                </div>
                <!-- /.col -->
            </div>
            <!-- /.social-auth-links -->
            <p class="mb-1">
                <a href="{% url 'forgot_password' %}">I forgot my password</a>
            </p>
        </div>
        <!-- /.login-card-body -->
    </div>
</div>
<!-- /.login-box -->

<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'dist/js/adminlte.min.js' %}"></script>
<script>
    $(document).ready(function() {
  // Retrieve CSRF token from cookies
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
  }

  $('#login-btn').click(function() {

    var username = $('#username').val();
    var password = $('#password').val();

    $.ajax({
        type: 'POST',
        url: '{% url 'login' %}',
        data: {
            username: username,
            password: password
        },
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        },
        success: function(response) {
    if (response.status === 'success') {
            console.log("response::", response.status)
                window.location.href = response.redirect_url;
            } else {
                $('#message').html(response.message);
            }
        },
        error: function () {
            $('#message').html("An error occurred while logging in.");
        }
    });
  });
  // Check if Enter key is pressed
  $(document).keypress(function(e) {
            if (e.which === 13) {
                $('#login-btn').click(); // Trigger click event of login button
            }
        });
  });
</script>
</body>
</html>
